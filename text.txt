flowchart TD
    Start([Start]) --> A[Fetch Latest SEBI Circulars]

    subgraph IngestionParsing["Ingestion & Parsing"]
        direction TB
        A --> B[Download circular PDFs/HTML]
        B --> C[Extract raw text<br />from documents]
        C --> D[Normalize text<br />(cleaning, encoding)]
        D --> E[Segment into sections<br />and clauses]
        E --> F[Store structured clauses<br />in Clause Table]
    end

    subgraph RequirementExtraction["1. Extract New Compliance Requirements"]
        direction TB
        F --> G[Identify regulatory intent<br />(NLP classification)]
        G --> H[Detect new vs existing<br />requirements]
        H --> I[Extract obligation details:<br />who, what, when, how often]
        I --> J[Tag requirements with:<br />domain, process, system, data]
        J --> K[Create/Update Requirement Repository]
    end

    subgraph GapAnalysis["2. Gap Analysis vs Existing Setup"]
        direction TB
        K --> L[Load existing policies,<br />SOPs, controls, mappings]
        L --> M[Map new requirements<br />to existing controls]
        M --> N{Coverage status?}
        N --> O[No gap:<br />mark as compliant]
        N --> P[Partial gap:<br />identify enhancements]
        N --> Q[Full gap:<br />new control needed]
        O --> R[Generate gap analysis report]
        P --> R
        Q --> R
    end

    subgraph ImpactAssessment["3. IT & Operational Impact Assessment"]
        direction TB
        R --> S[Link requirements to<br />IT assets & business processes]
        S --> T[Assess IT impact:<br />apps, interfaces, data, logs]
        T --> U[Assess operational impact:<br />roles, workflows, SLAs]
        U --> V[Estimate effort, cost,<br />timeline, risk]
        V --> W[Prioritize remediation<br />and assign owners]
        W --> X[Generate impact &<br />implementation roadmap]
    end

    X --> End([End])

    %% class definitions
    classDef statusOK fill:#d4f8d4,stroke:#2e7d32,stroke-width:1px
    classDef statusWarn fill:#fff3cd,stroke:#ff9800,stroke-width:1px
    classDef statusFail fill:#f8d7da,stroke:#c62828,stroke-width:1px

    %% class assignment
    class O statusOK
    class P statusWarn
    class Q statusFail
